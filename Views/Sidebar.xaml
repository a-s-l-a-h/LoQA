<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:LoQA.Models"
             x:Class="LoQA.Views.Sidebar"
             BackgroundColor="#2C3E50">

    <Grid RowDefinitions="Auto, Auto, *, Auto">

        <VerticalStackLayout Grid.Row="0" Padding="10" Spacing="15">
            <Label Text="LoQA" FontSize="32" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
            <Button x:Name="ModelsButton" Text="Models" Clicked="ModelsButton_Clicked" BackgroundColor="#5A6772" TextColor="White"/>
            <Button x:Name="NewChatButton" Text="+ New Chat" FontAttributes="Bold" Clicked="NewChatButton_Clicked" BackgroundColor="#007AFF" TextColor="White"/>
            <VerticalStackLayout Spacing="5">
                <Label Text="Temperature" TextColor="White" FontAttributes="Bold"/>

                <!-- =========================================================================
                     === ACTION: BIND THE SLIDER'S ENABLED STATE DIRECTLY                ===
                     ========================================================================= -->
                <!-- The slider is now only disabled when a response is actively generating. -->
                <!-- It remains enabled when viewing history or when the model is idle.      -->
                <Slider x:Name="TemperatureSlider" 
                        Minimum="0.0" 
                        Maximum="2.0" 
                        Value="0.8" 
                        ValueChanged="TemperatureSlider_ValueChanged"
                        IsEnabled="{Binding IsGenerating, Converter={StaticResource InverseBoolConverter}}"/>

                <Label x:Name="TemperatureValueLabel" Text="Current: 0.8" HorizontalOptions="Center" TextColor="#CCCCCC"/>
            </VerticalStackLayout>
        </VerticalStackLayout>

        <Label Grid.Row="1" Text="History" Margin="10,20,10,5" FontSize="Small" FontAttributes="Bold" TextColor="#CCCCCC"/>

        <CollectionView Grid.Row="2"
                        x:Name="ConversationsListView"
                        SelectionMode="Single"
                        ItemsSource="{Binding ConversationList}"
                        SelectionChanged="ConversationsListView_SelectionChanged">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:ChatHistory">
                    <Grid Padding="15,0,10,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup Name="CommonStates">
                                <VisualState Name="Normal" />
                                <VisualState Name="Selected">
                                    <VisualState.Setters>
                                        <Setter Property="BackgroundColor" Value="#007AFF" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <Label Grid.Column="0" Text="{Binding Name}" TextColor="White" VerticalOptions="Center" Padding="0,12"/>
                        <Button Grid.Column="1" Text="âŒ" FontSize="Small" BackgroundColor="Transparent" Clicked="DeleteButton_Clicked" CommandParameter="{Binding .}" VerticalOptions="Center"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Grid.Row="3"
                x:Name="SettingsButton"
                Text="Settings"
                Clicked="SettingsButton_Clicked"
                Margin="10" 
                BackgroundColor="#5A6772" 
                TextColor="White"/>

    </Grid>
</ContentView>